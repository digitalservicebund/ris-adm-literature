<script lang="ts" setup>
import { computed } from 'vue'
import IconBadge from '@/components/IconBadge.vue'
import { useAuthentication } from '@/services/auth'
import IconPermIdentity from '~icons/ic/baseline-perm-identity'
import IconLogout from '~icons/ic/baseline-logout'
import FlexContainer from '@/components/FlexContainer.vue'
import FlexItem from '@/components/FlexItem.vue'
import { useRoute } from 'vue-router'
import { ROUTE_NAMES, ROUTE_PATHS } from '@/constants/routes'
import { DocumentCategory } from '@/domain/documentType'

const { getUsername, logout, getGroup } = useAuthentication()
const route = useRoute()

const searchPath = computed(() => {
  if (route.meta.documentCategory === DocumentCategory.LITERATUR_UNSELBSTSTAENDIG) {
    return ROUTE_PATHS.ULI.BASE
  }
  if (route.meta.documentCategory === DocumentCategory.LITERATUR_SELBSTSTAENDIG) {
    return ROUTE_PATHS.SLI.BASE
  }
  if (route.meta.documentCategory === DocumentCategory.VERWALTUNGSVORSCHRIFTEN) {
    return ROUTE_PATHS.ADM.BASE
  }
  return '/'
})

const group = computed(() => (getGroup() ? `${getGroup()} | Staging` : `Staging`))
</script>

<template>
  <nav
    class="flex items-center justify-between border-y border-gray-400 px-24 py-16 print:hidden bg-white"
  >
    <div class="flex items-center gap-44">
      <div class="flex flex-col">
        <span class="ris-body1-bold">Rechtsinformationen</span>
        <span class="leading-none text-gray-900">des Bundes</span>
      </div>
      <router-link
        v-if="route.name !== ROUTE_NAMES.ROOT_REDIRECT"
        :to="searchPath"
        class="ris-label1-regular p-8 hover:bg-yellow-500 hover:underline"
        >Suche</router-link
      >
    </div>
    <div class="flex items-center gap-10">
      <FlexContainer alignItems="items-center">
        <IconPermIdentity data-testid="iconPermIdentity" />
        <FlexItem>
          {{ getUsername() ?? 'Vorname Nachname' }}
        </FlexItem>
        <FlexItem>
          <IconBadge :background-color="'bg-red-300'" color="text-black" :label="group" />
        </FlexItem>
        <FlexItem>
          <button @click="logout" class="hover:cursor-pointer" aria-label="Log out">
            <IconLogout class="h-5 w-5" />
          </button>
        </FlexItem>
      </FlexContainer>
    </div>
  </nav>
</template>
